<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Embedthis Appweb Public API</title>

<!-- BeginDsi "dsi/meta.html" -->
	<meta name="keywords" content="embedded web server, web server software, 
		embedded HTTP, application web server, embedded server,
		small web server, HTTP server, library web server, library HTTP,
		HTTP library" />
	<meta name="description" content="Embedthis Sofware provides 
		open source embedded web servers for devices and applications." />
	<meta name="robots" content="index,follow" />
	<meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
<!-- EndDsi -->

  

<!-- BeginDsi "dsi/js.html" -->
	<script language="JavaScript" type="text/javascript">
		document._ROOT_="../../../";
	</script>
<!-- EndDsi -->

  

<!-- BeginDsi "dsi/style.html" -->
	<link rel="stylesheet" type="text/css" href="../../../css/doc.css">
<!-- EndDsi -->

</head>

<body leftmargin="0" topmargin="0" marginheight="0" marginwidth="0">
  

<!-- BeginDsi "dsi/navTop.html" -->
	<div class="background">
		<table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td>
					<a name="top"></a>
					<img src="../../../images/backLeft.png" width="400" 
						height="93" border="0" ismap usemap="#home" /><br />
					<map name="home">
						<area coords="0,0,93,93" 
						href="http://www.mbedthis.com/index.html" />
					</map>
				</td>
				<td width="100%">
					<img src="../../../images/backMiddle.png" width="100%" 
						height="93" border="0" /><br />
				</td>
				<td>
					<img src="../../../images/backRight.png" width="354" 
						height="93" border="0" /><br />
				</td>
			</tr>
		</table>
	</div>

	<div class="navTop"> 
		<table cellpadding="0" cellspacing="0" border="0" align="top">
			<tr>
				<td valign="bottom"> 
					<a href="http://www.mbedthis.com/" class="navTop"
					>Embedthis Home</a> |&nbsp;
				</td>
				<td valign="bottom"> 
					<a href="../../../product/index.html" class="navTop"
					>Documentation Home</a> |&nbsp;
				</td>
				<td valign="bottom"> 
					<a href="../../../guide/appweb/users/admin/overview.html" class="navTop"
					>Administration</a> |&nbsp;
				</td>
				<td valign="bottom"> 
					<a href="../../../api/gen/appweb/overview.html" class="navTop"
					>Programmers Reference</a>
				</td>
				<td valign="bottom"> 
<!--
					<form class="smallText" action="../../../search.php" 
						method="post" name="searchForm" id="searchForm">
					</form>
					&nbsp; 
					<input class="smallText" type="text" name="search" 
						align="right" id="searchInput" size="15" maxlength="50"
						value="Sorry, No Searching" />
-->
				</td>
			</tr>
		</table>
	</div>

<!-- EndDsi -->

  <div class="navHistory">
    

<!-- BeginDsi "dsi/navHistory.html" -->
	<a href="../../../product/index.html">Documentation Home</a> &gt; 
<!-- EndDsi -->

     <a href="overview.html">Programmers Reference</a> &gt; <a href='files.html'>Files</a> &gt <b>malloc.cpp</b>
  </div>

  <table class="content" border="0" height="100%" width="100%">
    <tr>
      <td class="content">
</div>
<div class="contents">
<h1>mpr/malloc.cpp File Reference</h1>Fast and safe malloc replacemen for embedded use.  
<a href="#_details">More...</a>
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="malloc_8cpp.html#2b95acd23ddd4081f67e757543503eac">mprCreateMemHeap</a> (char *userBuf, int initialSize, int limit)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="malloc_8cpp.html#81351f1fbe58c0fd7a976ec949d80f8d">mprFree</a> (void *ptr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="malloc_8cpp.html#9447d1351ac6bba80f0c47b350d190af">mprMalloc</a> (uint size)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="malloc_8cpp.html#0a5b5028b3eabac5c5f46740899d9b0b">mprRealloc</a> (void *ptr, uint size)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="malloc_8cpp.html#fc08b0e79cf2b45a696ae6d87b3f80c8">mprStrdup</a> (const char *str)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Fast and safe malloc replacemen for embedded use. 
<p>
<dl class="user" compact><dt><b><b>Overview</b>:</b></dt><dd>This memory allocator is fast, thread-safe, SMP scaling. It tracks memory leaks and keeps allocation statistics with minimal overhead. It also extends the standard memory allocation API with "safer" APIs. </dd></dl>
<dl class="remark" compact><dt><b>Remarks:</b></dt><dd>This module is thread-safe. </dd></dl>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="2b95acd23ddd4081f67e757543503eac"></a><!-- doxytag: member="malloc.cpp::mprCreateMemHeap" ref="2b95acd23ddd4081f67e757543503eac" args="(char *userBuf, int initialSize, int limit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mprCreateMemHeap           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>userBuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>initialSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>limit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl class="user" compact><dt><b><b>Synopsis</b>:</b></dt><dd>Initialize the memory heap. </dd></dl>
<dl class="user" compact><dt><b><b>Overview</b>:</b></dt><dd>Initialize the memory heap. The Embedthis malloc subsystem offers several benefits: <ul>
<li>It can pre-allocate memory to ensure memory allocations do not fail </li>
<li>It can allocate memory out of a static user buffer so that no dynamic memory allocation calls will be made at run-time. Ideal for VxWorks which tends to fragment memory with high dynamic memory loads. </li>
<li>It can impose memory allocation limits so that other programs are not compromised. </li>
<li>A memory handler is called on memory allocation failures. </li>
</ul>
</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>userBuf</em>&nbsp;</td><td>NULL to dynamically allocate memory from the operating system. Set to a valid buffer of length <em>size</em> and memory will be allocated out of that buffer. Ideal for embedded systems such as VxWorks to ensure memory allocations cannot fail. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>initialSize</em>&nbsp;</td><td>Define the size of the supplied user buffer, or if <em>userBuf</em> is NULL, it defines the initial size of dynamic memory to allocate. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>limit</em>&nbsp;</td><td>Specify the maximum amount of dynamic memory to allocate. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Returns zero if successful. Otherwise a negative MPR error code. </dd></dl>
<dl class="user" compact><dt><b><b>Stability</b> <b>classification</b>:</b></dt><dd>Evolving. </dd></dl>
<dl class="user" compact><dt><b><b>Library</b>:</b></dt><dd>libappweb </dd></dl>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="mpr_8h.html#156391090ff3babe8018377e47a70a50">mprMalloc</a>, <a class="el" href="mpr_8h.html#81351f1fbe58c0fd7a976ec949d80f8d">mprFree</a> </dd></dl>

</div>
</div><p>
<a class="anchor" name="81351f1fbe58c0fd7a976ec949d80f8d"></a><!-- doxytag: member="malloc.cpp::mprFree" ref="81351f1fbe58c0fd7a976ec949d80f8d" args="(void *ptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mprFree           </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>ptr</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fd</em>&nbsp;</td><td>File descriptor. Note: this is not a FILE pointer type. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fmt</em>&nbsp;</td><td>Printf style format string </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Returns the number of bytes written </dd></dl>
<dl class="user" compact><dt><b><b>Stability</b> <b>classification</b>:</b></dt><dd>Evolving. </dd></dl>
<dl class="user" compact><dt><b><b>Library</b>:</b></dt><dd>libappweb </dd></dl>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="mpr_8h.html#c2256fbc4a2a35c5ec94a9bd835c4c37">mprPrintf</a>, <a class="el" href="mpr_8h.html#a92642cc92f5ed91fe6e736f153387de">mprLog</a> </dd></dl>
<dl class="user" compact><dt><b><b>Synopsis</b>:</b></dt><dd>Safe replacement for free. </dd></dl>
<dl class="user" compact><dt><b><b>Overview</b>:</b></dt><dd>mprFree should be used to free memory allocated by mprMalloc, mprRealloc or mprCalloc. </dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ptr</em>&nbsp;</td><td>Memory to free. If NULL, take no action. </td></tr>
  </table>
</dl>
<dl class="remark" compact><dt><b>Remarks:</b></dt><dd>mprFree can reduce the overall application code size by allowing the memory block <em>ptr</em> to be NULL. </dd></dl>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="mpr_8h.html#156391090ff3babe8018377e47a70a50">mprMalloc</a>, mprCalloc, <a class="el" href="mpr_8h.html#e79c5a301a9c0813dee2ee2e19eb041d">mprRealloc</a> </dd></dl>

</div>
</div><p>
<a class="anchor" name="9447d1351ac6bba80f0c47b350d190af"></a><!-- doxytag: member="malloc.cpp::mprMalloc" ref="9447d1351ac6bba80f0c47b350d190af" args="(uint size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void * mprMalloc           </td>
          <td>(</td>
          <td class="paramtype">uint&nbsp;</td>
          <td class="paramname"> <em>size</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl class="user" compact><dt><b><b>Synopsis</b>:</b></dt><dd>Safe replacement for malloc. </dd></dl>
<dl class="user" compact><dt><b><b>Overview</b>:</b></dt><dd>mprMalloc wraps the standard malloc or if BLD_FEATURE_MALLOC is enabled, it will replace malloc with a fast, deterministic embedded memory allocator that is more deterministic with regard to </dd></dl>

</div>
</div><p>
<a class="anchor" name="0a5b5028b3eabac5c5f46740899d9b0b"></a><!-- doxytag: member="malloc.cpp::mprRealloc" ref="0a5b5028b3eabac5c5f46740899d9b0b" args="(void *ptr, uint size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void * mprRealloc           </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl class="user" compact><dt><b><b>Synopsis</b>:</b></dt><dd>Safe replacement for realloc </dd></dl>
<dl class="user" compact><dt><b><b>Overview</b>:</b></dt><dd>mprRealloc should be used to reallocate memory blocks that have been allocated with mprMalloc or mprStrdup. </dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ptr</em>&nbsp;</td><td>Memory to reallocate. If NULL, call malloc. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>New size of the required memory block. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Returns a pointer to the newly allocated memory block. </dd></dl>
<dl class="remark" compact><dt><b>Remarks:</b></dt><dd>Do not mix calls to realloc and mprRealloc. </dd></dl>

</div>
</div><p>
<a class="anchor" name="fc08b0e79cf2b45a696ae6d87b3f80c8"></a><!-- doxytag: member="malloc.cpp::mprStrdup" ref="fc08b0e79cf2b45a696ae6d87b3f80c8" args="(const char *str)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char * mprStrdup           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>str</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl class="user" compact><dt><b><b>Synopsis</b>:</b></dt><dd>Safe replacement for strdup </dd></dl>
<dl class="user" compact><dt><b><b>Overview</b>:</b></dt><dd><a class="el" href="malloc_8cpp.html#fc08b0e79cf2b45a696ae6d87b3f80c8">mprStrdup()</a> should be used as a replacement for <b>strdup</b> wherever possible. It allows the strdup to be copied to be NULL, in which case it will allocate an empty string. </dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>str</em>&nbsp;</td><td>Pointer to string to duplicate. If <b>str</b> is NULL, allocate a new string containing only a trailing NULL character. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Returns an allocated string including trailing null. </dd></dl>
<dl class="remark" compact><dt><b>Remarks:</b></dt><dd>Memory allocated via <a class="el" href="malloc_8cpp.html#fc08b0e79cf2b45a696ae6d87b3f80c8">mprStrdup()</a> must be freed via <a class="el" href="malloc_8cpp.html#81351f1fbe58c0fd7a976ec949d80f8d">mprFree()</a>. </dd></dl>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="mpr_8h.html#81351f1fbe58c0fd7a976ec949d80f8d">mprFree</a>, <a class="el" href="mpr_8h.html#156391090ff3babe8018377e47a70a50">mprMalloc</a>, <a class="el" href="mpr_8h.html#e79c5a301a9c0813dee2ee2e19eb041d">mprRealloc</a>, mprCalloc </dd></dl>

</div>
</div><p>
</div>
	  </td>
      <td class="contentSep"></td>

      <td class="contentSideBar">
        <div class="linkSection">
          <h2>See Also</h2>

<!-- BeginDsi "dsi/api.html" -->
					<a href="../../../api/gen/appweb/overview.html">API Overview</a><br>
					<a href="../../../api/gen/appweb/c-api.html">C API</a><br>
					<a href="../../../api/gen/appweb/cplusplus-api.html">C++ API</a><br>
					<a href="../../../api/gen/appweb/javascript-api.html">JavaScript API</a><br>
					<a href="../../../api/gen/appweb/annotated.html">Class List</a><br>
					<a href="../../../api/gen/appweb/files.html">File List</a><br>
<!-- EndDsi -->

        </div>
      </td>
    </tr>
</table>

<!-- BeginDsi "dsi/terms.html" -->
<p class="terms"> 
	<a href="../../../product/copyright.html"
		>&copy; Embedthis Software LLC, 2003-2009. All 
		rights reserved. Embedthis is a trademark of Embedthis Software LLC.</a>
</p>
<!-- EndDsi -->

</body>
</html>
